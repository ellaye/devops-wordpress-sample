pipeline{
    agent {
        node {
            label 'maven'
        }
    }

    environment{
        KUBECONFIG_CREDENTIAL_ID = 'demo-kubeconfig'
    }

    stages {
	   stage ('checkout scm') {
               steps {
                 checkout(scm)
               }
            }
		
	   stage('deploy'){
               steps{
                 kubernetesDeploy(configs: 'deploy1/**', enableConfigSubstitution : true, kubeconfigId: "$KUBECONFIG_CREDENTIAL_ID")
               }
	    }

		
	   stage('delete'){
               steps{
                 kubernetesDeploy(configs: 'deploy1/**', deleteResource: true, enableConfigSubstitution : true, kubeconfigId: "$KUBECONFIG_CREDENTIAL_ID")
               }
            }
     }
}
